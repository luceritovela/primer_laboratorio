<!DOCTYPE html>
<html>
<head>
    <title>Usuarios</title>
</head>
<body>
    <h2>Lista de Usuarios</h2>
    <ul id="lista-usuarios">
        {% for usuario in usuarios %}
            <li id="usuario-{{ usuario.id }}">
                {{ usuario.id }} - {{ usuario.nombre }}
                <button onclick="eliminarUsuario({{ usuario.id }})">âŒ Eliminar</button>
            </li>
        {% endfor %}
    </ul>

    <h3>Agregar Usuario</h3>
    <input type="text" id="nombre" placeholder="Nombre del usuario">
    <button onclick="agregarUsuario()">â• Agregar</button>

    <h3>Buscar Usuario por ID</h3>
    <input type="number" id="buscar-id" placeholder="ID del usuario">
    <button onclick="buscarUsuario()">ğŸ” Buscar</button>

    <script>
        function agregarUsuario() {
            let nombre = document.getElementById("nombre").value;
            if (!nombre.trim()) {
                alert("âš ï¸ El nombre no puede estar vacÃ­o.");
                return;
            }

            fetch('/usuarios', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre: nombre })
            })
            .then(response => response.json())
            .then(data => {
                if (data.mensaje) {
                    alert(`âœ… ${data.mensaje}\nğŸ†” ID asignado: ${data.id}`);
                    location.reload(); // Recargar para actualizar la lista
                } else {
                    alert(`âŒ Error: ${data.error || "Desconocido"}`);
                }
            })
            .catch(error => alert("âŒ Error al conectar con el servidor."));
        }

        function eliminarUsuario(id) {
            if (!confirm("âš ï¸ Â¿Seguro que deseas eliminar este usuario?")) return;

            fetch(`/usuarios/${id}`, { method: 'DELETE' })
            .then(response => response.json())
            .then(data => {
                if (data.mensaje) {
                    alert(`âœ… ${data.mensaje}`);
                    document.getElementById(`usuario-${id}`).remove(); // Elimina el usuario de la lista sin recargar
                } else {
                    alert(`âŒ Error: ${data.error || "Desconocido"}`);
                }
            })
            .catch(error => alert("âŒ Error al conectar con el servidor."));
        }

        function buscarUsuario() {
            let id = document.getElementById("buscar-id").value;
            if (!id) {
                alert("âš ï¸ Debes ingresar un ID.");
                return;
            }

            fetch(`/usuarios/${id}`)
            .then(response => response.json())
            .then(data => {
                if (data.id) {
                    alert(`ğŸ” Usuario encontrado:\nğŸ†” ID: ${data.id}\nğŸ‘¤ Nombre: ${data.nombre}`);
                } else {
                    alert(`âŒ ${data.error || "Usuario no encontrado"}`);
                }
            })
            .catch(error => alert("âŒ Error al conectar con el servidor."));
        }
    </script>

    <a href="/logout">Cerrar sesiÃ³n</a>
</body>
</html>
